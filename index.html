<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‘ì¡´êµ¬ - ì˜í†  ëŒ€ê²°íŒ</title>
    <style>
        :root {
            --bg-main: #1a1e2e;
            --bg-secondary: #252a3e;
            --bg-tertiary: #323852;
            --text-white: #ffffff;
            --text-gray: #a0aec0;
            --blue: #4c6ef5;
            --red: #fa5252;
            --green: #40c057;
            --yellow: #fcc419;
            --modal-bg: #1e2337;
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-white);
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }

        #game-ui { display: none; flex-direction: column; align-items: center; width: 100%; }
        .game-container { display: flex; gap: 30px; width: 100%; max-width: 1200px; justify-content: center; flex-wrap: wrap; }
        
        #board-grid { flex: 2; display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        .tile { background-color: var(--bg-secondary); border-radius: 16px; aspect-ratio: 1/1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; border: 3px solid transparent; transition: 0.3s; }
        .flag { font-size: 36px; }
        .name { font-size: 13px; font-weight: bold; text-align: center; margin-top: 4px; }
        .adv-badge { font-size: 10px; background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 10px; margin-top: 4px; color: var(--yellow); }
        .token-zone { position: absolute; bottom: 8px; display: flex; gap: 4px; }
        .token { width: 14px; height: 14px; border-radius: 50%; border: 2px solid #222; }

        .p1-land { border-color: var(--red) !important; background: rgba(250, 82, 82, 0.1); }
        .p2-land { border-color: var(--blue) !important; background: rgba(76, 110, 245, 0.1); }
        .p3-land { border-color: var(--green) !important; background: rgba(64, 192, 87, 0.1); }
        .p4-land { border-color: #be4bdb !important; background: rgba(190, 75, 219, 0.1); }

        #sidebar { flex: 1; min-width: 320px; display: flex; flex-direction: column; gap: 20px; }
        .panel { background: var(--bg-secondary); border-radius: 20px; padding: 20px; }
        
        .rank-item { background: var(--bg-tertiary); margin-bottom: 10px; padding: 15px; border-radius: 15px; border-left: 5px solid transparent; }
        .rank-item.active { border-left-color: white; transform: scale(1.02); }
        .score-info { font-size: 12px; color: var(--text-gray); display: flex; gap: 10px; margin-top: 5px; }

        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 999; justify-content: center; align-items: center; }
        .modal-content { background: var(--modal-bg); padding: 30px; border-radius: 25px; width: 95%; max-width: 600px; text-align: center; border: 2px solid var(--red); }

        /* ëŒ€ê²° ì „ìš© ë ˆì´ì•„ì›ƒ */
        .battle-layout { display: flex; align-items: center; justify-content: space-between; gap: 20px; margin-top: 25px; }
        .battle-player-zone { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .battle-btn { width: 100%; padding: 20px; border-radius: 15px; border: none; color: white; font-weight: 800; cursor: pointer; transition: 0.2s; }
        .battle-btn:active { transform: scale(0.95); }
        .center-reg-box { flex: 1.5; background: rgba(250, 82, 82, 0.1); padding: 15px; border: 1px dashed var(--red); border-radius: 15px; font-size: 14px; }

        .btn-yes { background: #d93025; color: white; width: 100%; padding: 15px; border:none; border-radius: 12px; font-weight:bold; cursor: pointer; margin-top: 15px; }
        .btn-no { background: transparent; color: var(--text-gray); border: 1px solid var(--text-gray); width: 100%; padding: 10px; border-radius: 12px; margin-top: 10px; cursor: pointer; }

        #ending { display: none; position: fixed; inset: 0; background: black; z-index: 1000; flex-direction: column; justify-content: center; align-items: center; text-align: center; color: white; padding: 20px; }
        .ending-img { width: 300px; border-radius: 15px; margin: 20px; }
    </style>
</head>
<body>

    <div id="start-screen" style="text-align: center; max-width: 500px;">
        <h1 style="font-size: 50px; margin-bottom: 10px;">ğŸŒ ë‘ì¡´êµ¬</h1>
        <p style="color:var(--text-gray)">ëª¨ë“  í”Œë ˆì´ì–´ëŠ” ì¤‘êµ­(0)ì—ì„œ ì¶œë°œí•©ë‹ˆë‹¤.</p>
        <button onclick="startGame()" style="width:100%; padding:20px; font-size:20px; background:var(--red); color:white; border:none; border-radius:15px; cursor:pointer; font-weight:bold;">ê²Œì„ ì‹œì‘</button>
    </div>

    <div id="game-ui">
        <header style="margin-bottom: 20px;"><div id="round-txt" style="background: var(--bg-tertiary); padding: 5px 15px; border-radius: 20px;">ROUND 1 / 5</div></header>

        <div class="game-container">
            <div id="board-grid"></div>
            <div id="sidebar">
                <div class="panel"><h3>ğŸ“Š ì‹¤ì‹œê°„ í†µí•© ìˆœìœ„</h3><div id="rank-list"></div></div>
                <div class="panel" style="text-align:center">
                    <h3 id="turn-txt">ì°¨ë¡€</h3><div id="dice-val" style="font-size: 50px; margin: 10px;">ğŸ²</div>
                    <button id="roll-btn" onclick="rollDice()" style="width:100%; padding:15px; border-radius:10px; background:var(--blue); color:white; border:none; font-weight:bold; cursor:pointer;">ì£¼ì‚¬ìœ„ ë˜ì§€ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <div id="game-modal" class="modal-overlay">
        <div class="modal-content">
            <div id="g-modal-flag" style="font-size:50px"></div>
            <h2 id="g-modal-title">êµ­ê°€ëª…</h2>
            <div id="g-modal-adv-info" class="adv-badge" style="display:inline-block; font-size:14px; padding:5px 15px; margin-bottom:10px;">ë°œì „ì ìˆ˜ +1</div>
            <p id="g-modal-msg" style="color:var(--blue); font-weight:bold;"></p>
            <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:10px; text-align:left; font-size:14px; margin:15px 0;">
                <p><strong>âš ï¸ ê·œì œ:</strong> <span id="g-modal-reg"></span></p>
                <p><strong>âš¡ ì˜í–¥:</strong> <span id="g-modal-warn"></span></p>
            </div>
            <button class="btn-yes" onclick="decide(true)">ì´ ê³³ì„ ê°œë°œí•˜ê² ìŠµë‹ˆë‹¤</button>
            <button class="btn-no" onclick="decide(false)">ë³´ì¡´í•˜ê² ìŠµë‹ˆë‹¤</button>
        </div>
    </div>

    <div id="battle-modal" class="modal-overlay">
        <div class="modal-content" style="border-color: var(--yellow); max-width: 700px;">
            <h2 style="color:var(--yellow); margin:0;">âš”ï¸ ì˜í†  ìŸíƒˆ ëŒ€ê²° âš”ï¸</h2>
            <p style="margin-top:5px; color:#aaa;">ë¨¼ì € í´ë¦­í•˜ëŠ” ìª½ì´ ìŠ¹ë¦¬ í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤!</p>
            
            <div class="battle-layout">
                <div class="battle-player-zone">
                    <div style="font-size:12px; color:var(--text-gray)">ì†Œìœ í•œ í”Œë ˆì´ì–´</div>
                    <div id="owner-name" style="font-weight:bold; font-size:18px;"></div>
                    <button id="owner-btn" class="battle-btn" onclick="processBattle('owner')">ë°©ì–´í•˜ê¸°!</button>
                </div>

                <div class="center-reg-box">
                    <div id="battle-country" style="font-weight:bold; font-size:18px; margin-bottom:10px;"></div>
                    <div id="battle-reg" style="font-size:13px; color:#eee;"></div>
                </div>

                <div class="battle-player-zone">
                    <div style="font-size:12px; color:var(--text-gray)">ì¹¨ì…í•œ í”Œë ˆì´ì–´</div>
                    <div id="attacker-name" style="font-weight:bold; font-size:18px;"></div>
                    <button id="attacker-btn" class="battle-btn" onclick="processBattle('attacker')">ê³µê²©í•˜ê¸°!</button>
                </div>
            </div>

            <div id="battle-result-txt" style="margin-top:20px; font-size:18px; font-weight:bold; min-height:50px;"></div>
            <button id="battle-close-btn" class="btn-no" style="display:none; border-color:var(--yellow); color:var(--yellow);" onclick="closeBattle()">ê²°ê³¼ í™•ì¸ ì™„ë£Œ</button>
        </div>
    </div>

    <div id="ending">
        <div id="ending-content"></div>
        <button onclick="location.reload()" style="margin-top:20px; padding:10px 20px; cursor:pointer">ì²˜ìŒìœ¼ë¡œ</button>
    </div>

    <script>
        const players = [
            { id: 1, name: "í”Œë ˆì´ì–´ 1", color: "#fa5252", pos: 0, devScore: 0, advScore: 0, totalScore: 0, lands: [], css: "p1-land" },
            { id: 2, name: "í”Œë ˆì´ì–´ 2", color: "#4c6ef5", pos: 0, devScore: 0, advScore: 0, totalScore: 0, lands: [], css: "p2-land" },
            { id: 3, name: "í”Œë ˆì´ì–´ 3", color: "#40c057", pos: 0, devScore: 0, advScore: 0, totalScore: 0, lands: [], css: "p3-land" },
            { id: 4, name: "í”Œë ˆì´ì–´ 4", color: "#be4bdb", pos: 0, devScore: 0, advScore: 0, totalScore: 0, lands: [], css: "p4-land" }
        ];

        const mapData = [
            { id: 0, name: "ì¤‘êµ­", flag: "ğŸ‡¨ğŸ‡³", point: 1, reg: "ìˆ˜ì¶œ í†µì œ", warn: "ê³µê¸‰ë§ ë¶•ê´´" },
            { id: 1, name: "ë¯¸êµ­", flag: "ğŸ‡ºğŸ‡¸", point: 1, reg: "ì§€í•˜ìˆ˜ ê·œì œ", warn: "ì‹ìˆ˜ ìœ„ê¸°" },
            { id: 2, name: "EU", flag: "ğŸ‡ªğŸ‡º", point: 1, reg: "ìˆœí™˜ê²½ì œ ì§€ì¹¨", warn: "ì‹œì¥ í‡´ì¶œ" },
            { id: 3, name: "ì¼ë³¸", flag: "ğŸ‡¯ğŸ‡µ", point: 1, reg: "ë‚¨íš ê·œì œ", warn: "ìˆ˜ì‚°ìì› ê³ ê°ˆ" },
            { id: 4, name: "ë² íŠ¸ë‚¨", flag: "ğŸ‡»ğŸ‡³", point: 2, reg: "ê´‘ì‚°ì§€ì¹¨", warn: "í† ì§€ í™©íí™”" },
            { id: 5, name: "ì°¨ë“œ", flag: "ğŸ‡¹ğŸ‡©", point: 2, reg: "ê°œì • ê´‘ì—…ë²•", warn: "ìì› ì €ì£¼" },
            { id: 6, name: "ë‚˜ìš°ë£¨", flag: "ğŸ‡³ğŸ‡·", point: 2, reg: "ì‹¬í•´ì±„êµ´ ê¸ˆì§€", warn: "í•´ì–‘ íŒŒê´´" },
            { id: 7, name: "ë¶€ì‚°", flag: "ğŸ‡°ğŸ‡·", point: 1, reg: "ê³¨ì¬ ì±„ì·¨ë²•", warn: "í•´ì•ˆ ì¹¨ì‹" },
            { id: 8, name: "ì¹ ë ˆ", flag: "ğŸ‡¨ğŸ‡±", point: 2, reg: "ì—¼í˜¸ ë³´í˜¸", warn: "ìƒë¬¼ ë©¸ì¢…" },
            { id: 9, name: "ì•„ë¥´í—¨í‹°ë‚˜", flag: "ğŸ‡¦ğŸ‡·", point: 2, reg: "íˆ¬ì ì¸ì„¼í‹°ë¸Œ", warn: "ìŠµì§€ ì†Œë©¸" },
            { id: 10, name: "ì¸ë„ë„¤ì‹œì•„", flag: "ğŸ‡®ğŸ‡©", point: 2, reg: "í™˜ê²½í‰ê°€ ì™„í™”", warn: "ì—´ëŒ€ìš°ë¦¼ íŒŒê´´" },
            { id: 11, name: "ìºë‚˜ë‹¤", flag: "ğŸ‡¨ğŸ‡¦", point: 1, reg: "í™˜ê²½ ì±…ì„ ê°•í™”", warn: "í† ì–‘ ì˜¤ì—¼" },
            { id: 12, name: "ì„œìš¸", flag: "ğŸ‡°ğŸ‡·", point: 1, reg: "ìì›ì•ˆë³´ë²•", warn: "ì—ë„ˆì§€ ë§ˆë¹„" },
            { id: 13, name: "ëŒ€ë§Œ", flag: "ğŸ‡¹ğŸ‡¼", point: 1, reg: "ìˆ˜ìì› ê´€ë¦¬", warn: "ë°˜ë„ì²´ ì¤‘ë‹¨" },
            { id: 14, name: "í˜¸ì£¼", flag: "ğŸ‡¦ğŸ‡º", point: 1, reg: "ì›ì£¼ë¯¼ ìœ ì‚°ë³´í˜¸", warn: "ì‚¬íšŒ ê°ˆë“±" },
            { id: 15, name: "ë¸Œë¼ì§ˆ", flag: "ğŸ‡§ğŸ‡·", point: 2, reg: "ì‚°ë¦¼ë²•", warn: "ê¸°í›„ ì¬ì•™" }
        ];

        let turn = 0; let round = 1; const maxRound = 5;
        let boardOwner = new Array(16).fill(null);

        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-ui').style.display = 'flex';
            drawBoard(); updateRank();
        }

        function drawBoard() {
            const grid = document.getElementById('board-grid');
            grid.innerHTML = "";
            mapData.forEach((data, i) => {
                const div = document.createElement('div');
                div.className = "tile"; div.id = `tile-${i}`;
                div.innerHTML = `
                    <div class="flag">${data.flag}</div>
                    <div class="name">${data.name}</div>
                    <div class="adv-badge">ë°œì „ +${data.point}</div>
                    <div class="token-zone" id="zone-${i}"></div>
                `;
                grid.appendChild(div);
            });
            drawTokens();
        }

        function drawTokens() {
            document.querySelectorAll('.token').forEach(t => t.remove());
            players.forEach(p => {
                const zone = document.getElementById(`zone-${p.pos}`);
                const t = document.createElement('div');
                t.className = "token"; t.style.backgroundColor = p.color;
                zone.appendChild(t);
            });
        }

        function updateRank() {
            players.forEach(p => p.totalScore = p.devScore + p.advScore);
            const sorted = [...players].sort((a,b) => b.totalScore - a.totalScore);
            const list = document.getElementById('rank-list'); list.innerHTML = "";
            sorted.forEach((p, idx) => {
                list.innerHTML += `<div class="rank-item ${p.id===players[turn].id?'active':''}">
                    <div style="font-weight:bold; display:flex; justify-content:space-between;">
                        <span>${idx+1}ìœ„ ${p.name}</span><span>${p.totalScore}ì </span>
                    </div>
                    <div class="score-info"><span>ğŸ›  ê°œë°œ:${p.devScore}</span><span>âš¡ ë°œì „:${p.advScore}</span></div>
                </div>`;
            });
            document.getElementById('turn-txt').innerText = `${players[turn].name}ì˜ ì°¨ë¡€`;
            document.getElementById('turn-txt').style.color = players[turn].color;
        }

        function rollDice() {
            document.getElementById('roll-btn').disabled = true;
            let val = Math.floor(Math.random() * 6) + 1;
            document.getElementById('dice-val').innerText = `ğŸ² ${val}`;
            setTimeout(() => {
                players[turn].pos = (players[turn].pos + val) % 16;
                drawTokens();
                setTimeout(() => {
                    const owner = boardOwner[players[turn].pos];
                    if (owner && owner.id !== players[turn].id) openBattleModal(owner, players[turn], players[turn].pos);
                    else if (owner && owner.id === players[turn].id) { alert("ë³¸ì¸ ì˜í† ì…ë‹ˆë‹¤."); nextTurn(); }
                    else openModal(players[turn].pos);
                }, 500);
            }, 600);
        }

        // --- ë°°í‹€ ë¡œì§ ---
        let currentBattleInfo = null;
        function openBattleModal(owner, attacker, idx) {
            currentBattleInfo = { owner, attacker, idx };
            document.getElementById('owner-name').innerText = owner.name;
            document.getElementById('owner-btn').style.backgroundColor = owner.color;
            document.getElementById('attacker-name').innerText = attacker.name;
            document.getElementById('attacker-btn').style.backgroundColor = attacker.color;
            document.getElementById('battle-country').innerText = `${mapData[idx].flag} ${mapData[idx].name}`;
            document.getElementById('battle-reg').innerText = `ê·œì œ: ${mapData[idx].reg}`;
            
            document.getElementById('battle-result-txt').innerText = "ì „íˆ¬ ì¤€ë¹„! ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”!";
            document.getElementById('battle-close-btn').style.display = 'none';
            document.getElementById('owner-btn').disabled = false;
            document.getElementById('attacker-btn').disabled = false;
            document.getElementById('battle-modal').style.display = 'flex';
        }

        function processBattle(clickedRole) {
            document.getElementById('owner-btn').disabled = true;
            document.getElementById('attacker-btn').disabled = true;
            
            const { owner, attacker, idx } = currentBattleInfo;
            const isOwnerWin = (clickedRole === 'owner') ? Math.random() < 0.7 : Math.random() < 0.3; // í´ë¦­í•œ ìª½ì´ í™•ë¥  ë†’ìŒ

            const resTxt = document.getElementById('battle-result-txt');
            if (isOwnerWin) {
                resTxt.innerHTML = `<span style="color:var(--green)">ğŸ† ${owner.name} ë°©ì–´ ì„±ê³µ!</span><br><span style="font-size:14px;">ì†Œìœ ì +0.5 / ì¹¨ì…ì -0.5</span>`;
                owner.advScore += 0.5; attacker.advScore -= 0.5;
            } else {
                resTxt.innerHTML = `<span style="color:var(--red)">ğŸ”¥ ${attacker.name} ìŸíƒˆ ì„±ê³µ!</span><br><span style="font-size:14px;">ì†Œìœ ì -0.5 / ì¹¨ì…ì +0.5 / ì˜í†  êµì²´</span>`;
                owner.advScore -= 0.5; owner.devScore -= 1;
                attacker.advScore += 0.5; attacker.devScore += 1;
                boardOwner[idx] = attacker;
                const tile = document.getElementById(`tile-${idx}`);
                tile.className = `tile ${attacker.css}`;
                tile.querySelector('.name').innerHTML = `${mapData[idx].name}<br><span style="color:${attacker.color}; font-size:10px;">(ëºê¹€)</span>`;
            }
            document.getElementById('battle-close-btn').style.display = 'block';
        }

        function closeBattle() {
            document.getElementById('battle-modal').style.display = 'none';
            nextTurn();
        }

        // --- ê°œë°œ ë¡œì§ ---
        let currentLandIdx = -1;
        function openModal(idx) {
            currentLandIdx = idx; const data = mapData[idx];
            document.getElementById('g-modal-flag').innerText = data.flag;
            document.getElementById('g-modal-title').innerText = data.name;
            document.getElementById('g-modal-adv-info').innerText = `ë°œì „ì ìˆ˜ +${data.point}`;
            document.getElementById('g-modal-msg').innerText = `${players[turn].name}ë‹˜, ê°œë°œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
            document.getElementById('g-modal-reg').innerText = data.reg;
            document.getElementById('g-modal-warn').innerText = data.warn;
            document.getElementById('game-modal').style.display = 'flex';
        }

        function decide(isYes) {
            document.getElementById('game-modal').style.display = 'none';
            if (isYes) {
                const p = players[turn]; const land = mapData[currentLandIdx];
                boardOwner[currentLandIdx] = p; p.devScore += 1; p.advScore += land.point;
                const tile = document.getElementById(`tile-${currentLandIdx}`);
                tile.classList.add(p.css);
                tile.querySelector('.name').innerHTML += `<br><span style="color:${p.color}; font-size:10px;">(ê°œë°œë¨)</span>`;
            }
            nextTurn();
        }

        function nextTurn() {
            turn++;
            if (turn >= 4) {
                turn = 0; round++;
                if (round > maxRound) { showEnding(); return; }
                document.getElementById('round-txt').innerText = `ROUND ${round} / ${maxRound}`;
            }
            updateRank(); document.getElementById('roll-btn').disabled = false;
        }

        function showEnding() {
            const end = document.getElementById('ending');
            const totalLands = boardOwner.filter(x => x !== null).length;
            const winner = [...players].sort((a,b) => b.totalScore - a.totalScore)[0];
            let html = totalLands === 0 ? 
                `<h1>ğŸŒ¿ HAPPY ENDING</h1><img src="good.jpeg" class="ending-img"><p>ì§€êµ¬ê°€ ë³´ì¡´ë˜ì—ˆìŠµë‹ˆë‹¤!</p>` :
                `<h1>ğŸ’€ BAD ENDING</h1><img src="bad.jpeg" class="ending-img"><p>ìš°ìŠ¹: <b style="color:${winner.color}">${winner.name}</b> (${winner.totalScore}ì )</p><p style="color:var(--red)">ì´ ${totalLands}ê°œ ì§€ì—­ íŒŒê´´</p>`;
            document.getElementById('ending-content').innerHTML = html;
            end.style.display = 'flex';
        }
    </script>
</body>
</html>
