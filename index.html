<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‘ì¡´êµ¬ - ì±„êµ´ê¶Œ ì‹¸ì›€</title>
    <style>
        /* --- ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ --- */
        :root {
            --bg-main: #1a1e2e;
            --bg-secondary: #252a3e;
            --bg-tertiary: #323852;
            --text-white: #ffffff;
            --text-gray: #a0aec0;
            --blue: #4c6ef5;
            --red: #fa5252;
            --dark-red: #c92a2a;
            --green: #40c057;
            --yellow: #fcc419;
            --modal-bg: #1e2337;
            --warning-bg: rgba(250, 82, 82, 0.08);
            --info-bg: rgba(76, 110, 245, 0.08);
        }

        body {
            font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-white);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        button { font-family: 'Pretendard', sans-serif; }

        /* --- ì‹œì‘ í™”ë©´ ë° ê²Œì„ UI ìŠ¤íƒ€ì¼ ìƒëµ (ê¸°ì¡´ê³¼ ë™ì¼) --- */
        #start-screen { display: flex; flex-direction: column; align-items: center; max-width: 500px; width: 90%; text-align: center; animation: fadeIn 1s ease-in-out; }
        .start-logo { font-size: 80px; margin-bottom: 20px; animation: float 3s infinite ease-in-out; }
        .game-title { font-size: 48px; font-weight: 800; margin: 0; letter-spacing: -1px; }
        .game-subtitle { color: var(--text-gray); font-size: 16px; margin-top: 10px; margin-bottom: 50px; }
        .start-warning-box { background: rgba(26, 30, 46, 0.8); border: 2px solid var(--red); border-radius: 15px; padding: 25px; margin-bottom: 20px; width: 100%; box-sizing: border-box; }
        .rules-box { background: var(--bg-secondary); border-radius: 15px; padding: 25px; width: 100%; box-sizing: border-box; text-align: left; margin-bottom: 40px; }
        .btn-start { width: 100%; padding: 20px; font-size: 20px; font-weight: 800; color: white; background: linear-gradient(135deg, #d93025, #b71c1c); border: none; border-radius: 15px; cursor: pointer; }
        
        #game-ui { display: none; flex-direction: column; align-items: center; width: 100%; }
        .game-container { display: flex; gap: 30px; width: 100%; max-width: 1200px; justify-content: center; align-items: flex-start; flex-wrap: wrap; }
        #board-grid { flex: 2; min-width: 320px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        .tile { background-color: var(--bg-secondary); border-radius: 16px; aspect-ratio: 1/1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; border: 3px solid transparent; transition: 0.3s ease; cursor: pointer; }
        .flag { font-size: 40px; margin-bottom: 10px; }
        .name { font-size: 14px; font-weight: bold; text-align: center; }
        .token-zone { position: absolute; bottom: 8px; display: flex; gap: 4px; }
        .token { width: 14px; height: 14px; border-radius: 50%; border: 2px solid var(--bg-secondary); }

        /* íƒ€ì¼ ì†Œìœ ê¶Œ ìƒ‰ìƒ */
        .p1-land { border-color: #fa5252 !important; background: rgba(250, 82, 82, 0.1) !important; }
        .p2-land { border-color: #4c6ef5 !important; background: rgba(76, 110, 245, 0.1) !important; }
        .p3-land { border-color: #40c057 !important; background: rgba(64, 192, 87, 0.1) !important; }
        .p4-land { border-color: #be4bdb !important; background: rgba(190, 75, 219, 0.1) !important; }

        #sidebar { flex: 1; min-width: 300px; display: flex; flex-direction: column; gap: 25px; }
        .panel { background: var(--bg-secondary); border-radius: 20px; padding: 25px; }
        .rank-item { display: flex; align-items: center; background: var(--bg-tertiary); margin-bottom: 12px; padding: 15px; border-radius: 15px; }
        .rank-bar-bg { width: 100%; height: 8px; background: #555; border-radius: 4px; margin-top: 8px; overflow: hidden; }
        .rank-bar-fill { height: 100%; transition: width 0.6s; }

        /* --- ëª¨ë‹¬ ê³µí†µ ìŠ¤íƒ€ì¼ --- */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 999; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-content { background: var(--modal-bg); padding: 30px; border-radius: 25px; width: 90%; max-width: 500px; text-align: center; border: 2px solid var(--blue); }
        .desc-box { border-radius: 15px; padding: 20px; margin-bottom: 25px; text-align: left; }
        .warn-style { background: var(--warning-bg); border: 2px solid var(--red); }
        .btn-yes { background: linear-gradient(135deg, #d93025, #b71c1c); color: white; width: 100%; padding: 18px; border:none; border-radius: 12px; font-weight:800; font-size: 20px; cursor: pointer; }

        /* --- ì±„êµ´ê¶Œ ì‹¸ì›€ ì „ìš© ìŠ¤íƒ€ì¼ --- */
        .battle-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .battle-btn { height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px; border-radius: 15px; border: 2px solid rgba(255,255,255,0.1); color: white; cursor: pointer; transition: 0.2s; }
        .battle-btn:hover { transform: scale(1.05); border-color: white; }
        .battle-info-text { font-size: 11px; opacity: 0.8; margin-top: 5px; line-height: 1.3; }

        #ending { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 1000; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; }
        .ending-img { width: 300px; max-width: 80%; border-radius: 15px; margin: 20px 0; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="start-screen">
        <div class="start-logo">ğŸŒ</div>
        <h1 class="game-title">ë‘ì¡´êµ¬</h1>
        <p class="game-subtitle">ì±„êµ´ê¶Œ ì‹¸ì›€: í™˜ê²½ê³¼ ê°œë°œ ì‚¬ì´ì˜ ì¹˜ì—´í•œ ì„ íƒ</p>
        <div class="start-warning-box">
            <p class="warn-text">ì´ë¯¸ ê°œë°œëœ ì§€ì—­ì— ë„ì°©í•˜ë©´ <span style="color:var(--yellow); font-weight:bold;">'ì±„êµ´ê¶Œ ì‹¸ì›€'</span>ì´ ì‹œì‘ë©ë‹ˆë‹¤.</p>
        </div>
        <button class="btn-start" onclick="startGame()">â–· ê²Œì„ ì‹œì‘</button>
    </div>

    <div id="game-ui">
        <header style="text-align: center; margin-bottom: 20px;">
            <h1>ğŸŒ ë‘ì¡´êµ¬ ğŸŒ</h1>
            <div id="round-txt" style="background: var(--bg-tertiary); padding: 8px 20px; border-radius: 25px; margin-top: 10px; display: inline-block;">ROUND 1 / 5</div>
        </header>
        <div class="game-container">
            <div id="board-grid"></div>
            <div id="sidebar">
                <div class="panel">
                    <h3>ğŸ“Š ì‹¤ì‹œê°„ ì ìˆ˜ ìˆœìœ„</h3>
                    <div id="rank-list"></div>
                </div>
                <div class="panel" style="text-align: center;">
                    <h3 id="turn-txt">í”Œë ˆì´ì–´ 1ì˜ ì°¨ë¡€</h3>
                    <div id="dice-val" style="font-size: 60px; margin: 20px 0;">ğŸ²</div>
                    <button id="roll-btn" onclick="rollDice()" style="width: 100%; padding: 15px; background: var(--blue); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer;">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <div id="game-modal" class="modal-overlay">
        <div class="modal-content" style="border-color: var(--red);">
            <div id="g-modal-flag" style="font-size: 60px;"></div>
            <h2 id="g-modal-title" style="font-size: 32px; margin: 10px 0;"></h2>
            <div class="desc-box warn-style">
                <p id="g-modal-warning" style="font-size: 14px; margin-bottom: 10px;"></p>
                <hr style="opacity: 0.1; margin: 10px 0;">
                <p id="g-modal-regulation" style="font-size: 14px; color: var(--yellow);"></p>
            </div>
            <button class="btn-yes" onclick="decide(true)">âš¡ ì´ ê³³ì˜ ì±„êµ´ê¶Œì„ ê°€ì§ˆê¹Œìš”?</button>
            <button onclick="decide(false)" style="background:none; color:var(--text-gray); border:none; margin-top:15px; cursor:pointer;">ë³´ì¡´í•˜ê¸° (ì ìˆ˜ ì—†ìŒ)</button>
        </div>
    </div>

    <div id="battle-modal" class="modal-overlay">
        <div class="modal-content" style="border-color: var(--yellow); max-width: 550px;">
            <h2 style="color: var(--yellow); font-size: 28px; margin-bottom: 5px;">âš”ï¸ ì±„êµ´ê¶Œ ì‹¸ì›€ ë°œìƒ!</h2>
            <p id="battle-desc" style="font-size: 14px; margin-bottom: 20px;"></p>
            
            <div class="battle-grid">
                <button id="btn-owner-win" class="battle-btn">
                    <span style="font-weight: bold; font-size: 18px;">ë°©ì–´ì ìŠ¹ë¦¬</span>
                    <div class="battle-info-text">
                        ë°©ì–´ì: +0.5ì  / ì±„êµ´ê¶Œ ìƒì‹¤<br>
                        ì¹¨ì…ì: -0.5ì  / ì±„êµ´ê¶Œ íšë“
                    </div>
                </button>
                <button id="btn-attacker-win" class="battle-btn">
                    <span style="font-weight: bold; font-size: 18px;">ì¹¨ì…ì ìŠ¹ë¦¬</span>
                    <div class="battle-info-text">
                        ì¹¨ì…ì: +0.5ì  / ì±„êµ´ê¶Œ ìœ ì§€(+0)<br>
                        ë°©ì–´ì: -0.5ì  / ì±„êµ´ê¶Œ ìœ ì§€(+0)
                    </div>
                </button>
            </div>
            <p style="font-size: 12px; color: var(--text-gray); margin-top: 20px;">* ê·œì œ í€´ì¦ˆë¥¼ ë§íŒ í”Œë ˆì´ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”!</p>
        </div>
    </div>

    <div id="info-modal" class="modal-overlay">
        <div class="modal-content">
            <div id="i-modal-flag" style="font-size: 50px;"></div>
            <h2 id="i-modal-title"></h2>
            <p id="i-modal-regulation" style="text-align: left; font-size: 14px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;"></p>
            <button onclick="closeInfo()" style="margin-top: 20px; padding: 10px 20px; cursor: pointer;">ë‹«ê¸°</button>
        </div>
    </div>

    <div id="ending">
        <div id="ending-content"></div>
        <button onclick="location.reload()" style="margin-top:30px; padding:10px 20px; cursor:pointer;">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
    </div>

    <script>
        /* --- ë°ì´í„° ì„¤ì • --- */
        const players = [
            { id: 1, name: "í”Œë ˆì´ì–´ 1", color: "#fa5252", pos: 0, score: 0, lands: [], css: "p1-land" },
            { id: 2, name: "í”Œë ˆì´ì–´ 2", color: "#4c6ef5", pos: 0, score: 0, lands: [], css: "p2-land" },
            { id: 3, name: "í”Œë ˆì´ì–´ 3", color: "#40c057", pos: 0, score: 0, lands: [], css: "p3-land" },
            { id: 4, name: "í”Œë ˆì´ì–´ 4", color: "#be4bdb", pos: 0, score: 0, lands: [], css: "p4-land" }
        ];

        const mapData = [
            { id: 0, name: "ì¤‘êµ­", flag: "ğŸ‡¨ğŸ‡³", regulation: "í¬í† ë¥˜ ìˆ˜ì¶œ í†µì œ", warning: "êµ­ì œ ê³µê¸‰ë§ ë¶•ê´´ ë° ì™¸êµì  ê°ˆë“±" },
            { id: 1, name: "ë¯¸êµ­", flag: "ğŸ‡ºğŸ‡¸", regulation: "ì§€í•˜ìˆ˜ ê´€ë¦¬ ê·œì œ", warning: "ì§€í•˜ìˆ˜ ê³ ê°ˆ ë° ì§€ì—­ ì£¼ë¯¼ ì‹ìˆ˜ ìœ„ê¸°" },
            { id: 2, name: "EU", flag: "ğŸ‡ªğŸ‡º", regulation: "ìˆœí™˜ê²½ì œ ê·œì œ", warning: "ê·¸ë¦°ì›Œì‹± ì†Œì†¡ ë° ì‹œì¥ í‡´ì¶œ" },
            { id: 3, name: "ì¼ë³¸", flag: "ğŸ‡¯ğŸ‡µ", regulation: "ìˆ˜ì‚° ìì› ê´€ë¦¬ë²•", warning: "ì–´ì¢… ê³ ê°ˆ ë° í•´ì–‘ ìƒíƒœê³„ íŒŒê´´" },
            { id: 4, name: "ë² íŠ¸ë‚¨", flag: "ğŸ‡»ğŸ‡³", regulation: "ê´‘ì‚°ì§€ì¹¨ ê°•í™”", warning: "í† ì§€ í™©íí™” ë° ë¶ˆë²• ì±„êµ´ í™•ì‚°" },
            { id: 5, name: "ì°¨ë“œ", flag: "ğŸ‡¹ğŸ‡©", regulation: "ê°œì • ê´‘ì—…ë²•", warning: "ë‹¨ê¸° ìˆ˜ìµ ìœ„ì£¼ ê°œë°œë¡œ ì¸í•œ ìì›ì˜ ì €ì£¼" },
            { id: 6, name: "ë‚˜ìš°ë£¨", flag: "ğŸ‡³ğŸ‡·", regulation: "ì‹¬í•´ì±„êµ´ ê·œì œ ìš”ì²­", warning: "ì‹¬í•´ ìƒíƒœê³„ì˜ ì˜êµ¬ì  ì†ìƒ" },
            { id: 7, name: "ë¶€ì‚°", flag: "ğŸ‡°ğŸ‡·", regulation: "ê³¨ì¬ ì±„ì·¨ë²•", warning: "í•´ì–‘ ì¹¨ì‹ ë° í™ìˆ˜ ì¬í•´ ìœ„í—˜ ì¦ê°€" },
            { id: 8, name: "ì¹ ë ˆ", flag: "ğŸ‡¨ğŸ‡±", regulation: "ì—¼í˜¸ ë³´í˜¸êµ¬ì—­ ì§€ì •", warning: "ì—¼ìˆ˜ ê³¼ì‰ ì¶”ì¶œë¡œ ì¸í•œ ìƒë¬¼ ë©¸ì¢…" },
            { id: 9, name: "ì•„ë¥´í—¨í‹°ë‚˜", flag: "ğŸ‡¦ğŸ‡·", regulation: "íˆ¬ì ì¸ì„¸í‹°ë¸Œ ì¡°í•­", warning: "ì‹ìˆ˜ ë¶€ì¡± ë° ìŠµì§€ ì†Œë©¸" },
            { id: 10, name: "ì¸ë„ë„¤ì‹œì•„", flag: "ğŸ‡®ğŸ‡©", regulation: "í™˜ê²½ì˜í–¥í‰ê°€ ì™„í™”", warning: "ì—´ëŒ€ìš°ë¦¼ í›¼ì† ë° í•´ì–‘ ì˜¤ì—¼" },
            { id: 11, name: "ìºë‚˜ë‹¤", flag: "ğŸ‡¨ğŸ‡¦", regulation: "ê´‘ì‚° í™˜ê²½ ì±…ì„ ê°•í™”", warning: "ì¤‘ê¸ˆì† ì¶•ì  ë° ì£¼ë¯¼ ê±´ê°• ì•…í™”" },
            { id: 12, name: "ì„œìš¸", flag: "ğŸ‡°ğŸ‡·", regulation: "êµ­ê°€ìì›ì•ˆë³´ë²•", warning: "í•µì‹¬ ìì› ê³µê¸‰ ì¤‘ë‹¨ ì‹œ ì‚°ì—… ë§ˆë¹„" },
            { id: 13, name: "ëŒ€ë§Œ", flag: "ğŸ‡¹ğŸ‡¼", regulation: "ì—ë„ˆì§€ ìˆ˜ìì› ê´€ë¦¬", warning: "ê°€ë­„ ì‹œ ë°˜ë„ì²´ ìƒì‚° ì¤‘ë‹¨" },
            { id: 14, name: "í˜¸ì£¼", flag: "ğŸ‡¦ğŸ‡º", regulation: "ì›ì£¼ë¯¼ ìœ ì‚° ë³´í˜¸", warning: "ì‚¬íšŒì  ê°ˆë“± ë° í”„ë¡œì íŠ¸ ì¤‘ë‹¨" },
            { id: 15, name: "ë¸Œë¼ì§ˆ", flag: "ğŸ‡§ğŸ‡·", regulation: "ì•„ë§ˆì¡´ ê°œë°œ ì œí•œ", warning: "ê¸°í›„ ì¬ì•™ ì´ˆë˜ ë° êµ­ì œ ì œì¬" }
        ];

        let turn = 0;
        let round = 1;
        const maxRound = 5;
        let boardOwner = new Array(16).fill(0); // 0: ì£¼ì¸ ì—†ìŒ, 1~4: í”Œë ˆì´ì–´ ID

        /* --- ê²Œì„ ì—”ì§„ --- */
        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-ui').style.display = 'flex';
            const startPositions = [0, 12, 8, 4];
            players.forEach((p, idx) => p.pos = startPositions[idx]);
            drawBoard();
            updateRank();
        }

        function drawBoard() {
            const grid = document.getElementById('board-grid');
            grid.innerHTML = "";
            mapData.forEach((data, i) => {
                const div = document.createElement('div');
                div.className = "tile";
                div.id = `tile-${i}`;
                div.onclick = () => showInfo(i);
                div.innerHTML = `<div class="flag">${data.flag}</div><div class="name">${data.name}</div><div class="token-zone" id="zone-${i}"></div>`;
                grid.appendChild(div);
            });
            drawTokens();
        }

        function drawTokens() {
            document.querySelectorAll('.token').forEach(e => e.remove());
            players.forEach(p => {
                const zone = document.getElementById(`zone-${p.pos}`);
                if(zone) {
                    const t = document.createElement('div');
                    t.className = "token";
                    t.style.backgroundColor = p.color;
                    zone.appendChild(t);
                }
            });
        }

        function updateRank() {
            const list = document.getElementById('rank-list');
            list.innerHTML = "";
            let sorted = [...players].sort((a,b) => b.score - a.score);
            sorted.forEach((p, idx) => {
                const isActive = (p.id === players[turn].id);
                list.innerHTML += `
                    <div class="rank-item" style="${isActive ? 'border-left: 5px solid white; background:#3b4259;' : ''}">
                        <div style="flex:1">
                            <div style="display:flex; justify-content:space-between; font-weight:bold;">
                                <span>${p.name}</span><span>${p.score.toFixed(1)}ì </span>
                            </div>
                            <div class="rank-bar-bg"><div class="rank-bar-fill" style="width:${p.score * 10}%; background:${p.color}"></div></div>
                        </div>
                    </div>`;
            });
            document.getElementById('turn-txt').innerText = `${players[turn].name}ì˜ ì°¨ë¡€`;
            document.getElementById('turn-txt').style.color = players[turn].color;
        }

        function rollDice() {
            const btn = document.getElementById('roll-btn');
            btn.disabled = true;
            const val = Math.floor(Math.random() * 6) + 1;
            document.getElementById('dice-val').innerText = "ğŸ² " + val;
            setTimeout(() => movePlayer(val), 600);
        }

        function movePlayer(steps) {
            const p = players[turn];
            p.pos = (p.pos + steps) % 16;
            drawTokens();
            setTimeout(() => checkLand(p.pos), 500);
        }

        /* --- ì±„êµ´ê¶Œ ì‹¸ì›€ ë¡œì§ (í•µì‹¬) --- */
        function checkLand(idx) {
            const ownerId = boardOwner[idx];
            const currentPlayer = players[turn];

            if(ownerId !== 0 && ownerId !== currentPlayer.id) {
                // ì±„êµ´ê¶Œ ì‹¸ì›€ ì‹œì‘
                openBattleModal(idx, ownerId);
            } else if (ownerId === currentPlayer.id) {
                // ë³¸ì¸ ë•…ì€ í†µê³¼
                nextTurn();
            } else {
                // ì£¼ì¸ ì—†ëŠ” ë•… ê°œë°œ
                openGameModal(idx);
            }
        }

        function openBattleModal(idx, ownerId) {
            const land = mapData[idx];
            const owner = players.find(p => p.id === ownerId);
            const attacker = players[turn];

            document.getElementById('battle-desc').innerHTML = `
                <span style="color:${attacker.color}">${attacker.name}</span>ì´(ê°€) 
                <span style="color:${owner.color}">${owner.name}</span>ì˜ <b>${land.name}</b> ì±„êµ´ì§€ì— ì§„ì…í–ˆìŠµë‹ˆë‹¤!
            `;
            
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì„¤ì •
            const btnOwner = document.getElementById('btn-owner-win');
            const btnAttacker = document.getElementById('btn-attacker-win');
            
            btnOwner.style.backgroundColor = owner.color;
            btnAttacker.style.backgroundColor = attacker.color;

            // ì´ë²¤íŠ¸ ë°”ì¸ë”©
            btnOwner.onclick = () => handleBattleResult("owner", idx, owner, attacker);
            btnAttacker.onclick = () => handleBattleResult("attacker", idx, owner, attacker);

            document.getElementById('battle-modal').style.display = 'flex';
        }

        function handleBattleResult(winner, idx, owner, attacker) {
            if(winner === "owner") {
                // ë°©ì–´ì ìŠ¹ë¦¬ ì‹œ: ë°©ì–´ì +0.5(ê°€ì ) & ë•… ëºê¹€ / ì¹¨ì…ì -0.5(ê°ì ) & ë•… ì–»ìŒ
                owner.score += 0.5;
                owner.lands = owner.lands.filter(l => l !== mapData[idx].name);
                
                attacker.score = Math.max(0, attacker.score - 0.5);
                attacker.lands.push(mapData[idx].name);
                
                boardOwner[idx] = attacker.id;
                updateTileUI(idx, attacker);
            } else {
                // ì¹¨ì…ì ìŠ¹ë¦¬ ì‹œ: ì¹¨ì…ì +0.5 / ë°©ì–´ì -0.5 / ì†Œìœ ê¶Œ ë³€ë™ ì—†ìŒ(+0)
                attacker.score += 0.5;
                owner.score = Math.max(0, owner.score - 0.5);
            }
            
            document.getElementById('battle-modal').style.display = 'none';
            updateRank();
            nextTurn();
        }

        /* --- UI ì—…ë°ì´íŠ¸ ë³´ì¡° --- */
        function updateTileUI(idx, newOwner) {
            const tile = document.getElementById(`tile-${idx}`);
            players.forEach(p => tile.classList.remove(p.css));
            tile.classList.add(newOwner.css);
            tile.querySelector('.name').innerHTML = `${mapData[idx].name}<br><span style="color:${newOwner.color}; font-size:10px;">(ì±„êµ´ê¶Œ ì´ì „)</span>`;
        }

        /* --- ê¸°ì¡´ ë¡œì§ (ê°œë°œ ë° í„´ê´€ë¦¬) --- */
        let currentIdx = -1;
        function openGameModal(idx) {
            currentIdx = idx;
            const data = mapData[idx];
            document.getElementById('g-modal-flag').innerText = data.flag;
            document.getElementById('g-modal-title').innerText = data.name;
            document.getElementById('g-modal-warning').innerText = "âš ï¸ " + data.warning;
            document.getElementById('g-modal-regulation').innerText = "ğŸ“Œ " + data.regulation;
            document.getElementById('game-modal').style.display = 'flex';
        }

        function decide(develop) {
            const p = players[turn];
            if(develop) {
                boardOwner[currentIdx] = p.id;
                p.score += 1;
                p.lands.push(mapData[currentIdx].name);
                updateTileUI(currentIdx, p);
            }
            document.getElementById('game-modal').style.display = 'none';
            nextTurn();
        }

        function nextTurn() {
            turn++;
            if(turn >= 4) {
                turn = 0;
                round++;
                if(round > maxRound) { gameOver(); return; }
                document.getElementById('round-txt').innerText = `ROUND ${round} / ${maxRound}`;
            }
            updateRank();
            document.getElementById('roll-btn').disabled = false;
        }

        function showInfo(idx) {
            if(document.getElementById('game-modal').style.display === 'flex') return;
            const data = mapData[idx];
            document.getElementById('i-modal-flag').innerText = data.flag;
            document.getElementById('i-modal-title').innerText = data.name;
            document.getElementById('i-modal-regulation').innerText = data.regulation + "\n\n" + data.warning;
            document.getElementById('info-modal').style.display = 'flex';
        }

        function closeInfo() { document.getElementById('info-modal').style.display = 'none'; }

        function gameOver() {
            const ending = document.getElementById('ending');
            const content = document.getElementById('ending-content');
            let winners = [...players].sort((a,b) => b.score - a.score);
            content.innerHTML = `
                <h1 style="color:var(--red)">ê²Œì„ ì¢…ë£Œ</h1>
                <p>ìµœì¢… ìš°ìŠ¹: <span style="color:${winners[0].color}">${winners[0].name}</span></p>
                <div style="margin: 20px 0; font-size: 14px; color:#ccc;">
                    ${players.map(p => `${p.name}: ${p.score.toFixed(1)}ì `).join('<br>')}
                </div>
                <p style="color:var(--yellow)">ë¬´ë¶„ë³„í•œ ì±„êµ´ë¡œ ì§€êµ¬ê°€ íŒŒê´´ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            `;
            ending.style.display = 'flex';
        }
    </script>
</body>
</html>
